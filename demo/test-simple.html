<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>G-SSO Final Test</title>
  
  <!-- React -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      color: white;
    }
    .container {
      text-align: center;
      max-width: 800px;
      width: 100%;
    }
    h1 {
      font-size: 48px;
      margin-bottom: 16px;
      background: linear-gradient(135deg, #06b6d4 0%, #3b82f6 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .status-box {
      background: rgba(0,0,0,0.3);
      padding: 24px;
      border-radius: 16px;
      margin: 24px 0;
      text-align: left;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      line-height: 1.6;
    }
    .status-item {
      margin: 8px 0;
      display: flex;
      align-items: center;
    }
    .status-icon {
      margin-right: 8px;
      font-size: 16px;
    }
    .error {
      background: rgba(239,68,68,0.2);
      border: 2px solid #ef4444;
    }
    .success {
      background: rgba(16,185,129,0.2);
      border: 2px solid #10b981;
    }
    .warning {
      background: rgba(251,191,36,0.2);
      border: 2px solid #fbbf24;
    }
    .user-box {
      background: rgba(16,185,129,0.2);
      border: 2px solid #10b981;
      padding: 20px;
      border-radius: 12px;
      margin: 20px 0;
    }
    .user-detail {
      margin: 12px 0;
      text-align: left;
    }
    .user-detail strong {
      display: block;
      font-size: 11px;
      text-transform: uppercase;
      color: #10b981;
      margin-bottom: 6px;
    }
    .user-address {
      font-family: monospace;
      font-size: 12px;
      padding: 10px;
      background: rgba(0,0,0,0.3);
      border-radius: 6px;
      word-break: break-all;
    }
    button {
      padding: 14px 32px;
      background: linear-gradient(135deg, #06b6d4 0%, #3b82f6 100%);
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(6,182,212,0.3);
      transition: all 0.2s;
      margin: 8px;
    }
    button:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(6,182,212,0.4);
    }
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    .disconnect-btn {
      background: rgba(239,68,68,0.2);
      border: 2px solid #ef4444;
      color: #ef4444;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script>
    console.log('=== G-SSO SDK Final Test ===');
    console.log('Step 1: Checking React...');
    console.log('React:', typeof React !== 'undefined' ? '‚úÖ' : '‚ùå');
    console.log('ReactDOM:', typeof ReactDOM !== 'undefined' ? '‚úÖ' : '‚ùå');
  </script>

  <!-- Load SDK -->
  <script src="../dist/gsso.umd.js"></script>

  <script>
    console.log('Step 2: Checking SDK loaded...');
    console.log('window.GSSO:', window.GSSO);
    console.log('Type of GSSO:', typeof window.GSSO);
    
    if (window.GSSO) {
      console.log('Available exports:', Object.keys(window.GSSO));
      console.log('ConnectWallet:', window.GSSO.ConnectWallet);
      console.log('GSSO class:', window.GSSO.GSSO);
    }

    const { useState } = React;

    function App() {
      const [user, setUser] = useState(null);
      const [loading, setLoading] = useState(false);

      // Debug info
      const sdkLoaded = typeof window.GSSO !== 'undefined';
      const sdkType = typeof window.GSSO;
      const sdkKeys = window.GSSO ? Object.keys(window.GSSO) : [];
      const hasConnectWallet = window.GSSO && window.GSSO.ConnectWallet;

      // If SDK not loaded or empty
      if (!sdkLoaded || !window.GSSO || (Array.isArray(window.GSSO) && window.GSSO.length === 0)) {
        return React.createElement('div', { className: 'container' },
          React.createElement('h1', null, '‚ùå SDK Not Loaded'),
          React.createElement('div', { className: 'status-box error' },
            React.createElement('div', { className: 'status-item' },
              React.createElement('span', { className: 'status-icon' }, '‚ùå'),
              'window.GSSO: ' + (sdkLoaded ? 'exists but empty/invalid' : 'undefined')
            ),
            React.createElement('div', { className: 'status-item' },
              React.createElement('span', { className: 'status-icon' }, 'üìã'),
              'Type: ' + sdkType
            ),
            React.createElement('div', { className: 'status-item' },
              React.createElement('span', { className: 'status-icon' }, 'üîë'),
              'Keys: ' + JSON.stringify(sdkKeys)
            )
          ),
          React.createElement('div', { className: 'status-box warning', style: { marginTop: '20px' } },
            React.createElement('strong', { style: { display: 'block', marginBottom: '12px' } }, 'üîß How to Fix:'),
            React.createElement('div', null, '1. Check dist/gsso.umd.js exists'),
            React.createElement('div', null, '2. Rebuild: npm run build'),
            React.createElement('div', null, '3. Update src/index.ts exports'),
            React.createElement('div', null, '4. Reload this page')
          )
        );
      }

      // If no ConnectWallet component
      if (!hasConnectWallet) {
        return React.createElement('div', { className: 'container' },
          React.createElement('h1', null, '‚ö†Ô∏è ConnectWallet Missing'),
          React.createElement('div', { className: 'status-box warning' },
            React.createElement('div', { className: 'status-item' },
              React.createElement('span', { className: 'status-icon' }, '‚úÖ'),
              'SDK loaded: Yes'
            ),
            React.createElement('div', { className: 'status-item' },
              React.createElement('span', { className: 'status-icon' }, '‚ùå'),
              'ConnectWallet: Not found'
            ),
            React.createElement('div', { className: 'status-item' },
              React.createElement('span', { className: 'status-icon' }, 'üìã'),
              'Available: ' + sdkKeys.join(', ')
            )
          )
        );
      }

      const ConnectWallet = window.GSSO.ConnectWallet;

      const handleConnect = (result) => {
        console.log('‚úÖ Connected:', result);
        setUser({
          address: result.address,
          chainType: result.chainType,
          token: result.token
        });
        setLoading(false);
      };

      const handleError = (error) => {
        console.error('‚ùå Connection error:', error);
        alert('Connection failed: ' + error.message);
        setLoading(false);
      };

      const handleDisconnect = () => {
        setUser(null);
        setLoading(false);
      };

      if (user) {
        return React.createElement('div', { className: 'container' },
          React.createElement('h1', null, 'üîê G-SSO SDK'),
          React.createElement('div', { className: 'user-box' },
            React.createElement('h2', { style: { marginBottom: '20px', fontSize: '24px', color: '#10b981' } }, '‚úÖ Connected!'),
            React.createElement('div', { className: 'user-detail' },
              React.createElement('strong', null, 'Wallet Address'),
              React.createElement('div', { className: 'user-address' }, user.address)
            ),
            React.createElement('div', { className: 'user-detail' },
              React.createElement('strong', null, 'Chain'),
              React.createElement('div', { 
                style: { 
                  display: 'inline-block',
                  padding: '6px 16px',
                  background: 'rgba(6,182,212,0.2)',
                  border: '1px solid #06b6d4',
                  borderRadius: '20px',
                  fontSize: '14px',
                  textTransform: 'uppercase',
                  fontWeight: '600'
                } 
              }, user.chainType)
            ),
            React.createElement('button', {
              className: 'disconnect-btn',
              onClick: handleDisconnect
            }, 'Disconnect')
          )
        );
      }

      return React.createElement('div', { className: 'container' },
        React.createElement('h1', null, 'üîê G-SSO SDK'),
        React.createElement('p', { style: { fontSize: '18px', marginBottom: '24px' } }, 
          'Multi-chain wallet authentication'
        ),
        
        React.createElement('div', { className: 'status-box success' },
          React.createElement('div', { className: 'status-item' },
            React.createElement('span', { className: 'status-icon' }, '‚úÖ'),
            'SDK Status: Loaded'
          ),
          React.createElement('div', { className: 'status-item' },
            React.createElement('span', { className: 'status-icon' }, '‚úÖ'),
            'ConnectWallet: Available'
          ),
          React.createElement('div', { className: 'status-item' },
            React.createElement('span', { className: 'status-icon' }, 'üåê'),
            'Backend: http://localhost:3001'
          )
        ),

        React.createElement(ConnectWallet, {
          apiUrl: 'http://localhost:3001',
          buttonText: loading ? 'Connecting...' : 'Connect Wallet',
          onConnect: handleConnect,
          onError: handleError
        }),

        React.createElement('div', { className: 'status-box', style: { marginTop: '20px', fontSize: '11px' } },
          React.createElement('div', null, 'üí° Make sure your backend is running on port 3001'),
          React.createElement('div', null, 'üì± Click "Connect Wallet" to open the modal'),
          React.createElement('div', null, 'üîê Select a wallet to authenticate')
        )
      );
    }

    // Render
    try {
      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(React.createElement(App));
      console.log('‚úÖ App rendered successfully');
    } catch (error) {
      console.error('‚ùå Render error:', error);
      document.getElementById('root').innerHTML = `
        <div style="text-align: center; color: white; padding: 40px;">
          <h1>‚ùå Render Error</h1>
          <p style="margin-top: 20px;">${error.message}</p>
        </div>
      `;
    }
  </script>
</body>
</html>